-- Enable the UUID extension
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

CREATE TABLE Role (
    id SERIAL PRIMARY KEY,
    nome VARCHAR(50) NOT NULL UNIQUE,
);

CREATE TABLE Usuario (
    id_usuario UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    nomeCompleto VARCHAR(100) NOT NULL,
    cpf_cnpj VARCHAR(14) NOT NULL UNIQUE,
    dataNascimento DATE NOT NULL,
    genero VARCHAR(20),
    telefone VARCHAR(15),
    email VARCHAR(100) NOT NULL UNIQUE,
    senha VARCHAR(255) NOT NULL,
    categoria VARCHAR(50),
    fk_id_role INT,
    CONSTRAINT fk_role FOREIGN KEY (fk_id_role) REFERENCES Role(id) ON DELETE SET NULL
);

CREATE TABLE Endereco (
    id_endereco UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    cidade VARCHAR(50),
    latitude DECIMAL,
    longitude DECIMAL,
    rua VARCHAR(50),
    bairro VARCHAR(50),
    numero INT,
    complemento VARCHAR(50),
    estado VARCHAR(2),
    fk_id_usuario UUID REFERENCES Usuario(id_usuario) ON DELETE CASCADE
    fk_id_embarcacao UUID REFERENCES Embarcacao(id_embarcacao)  

);

CREATE TABLE Marinheiro (
    id_marinheiro UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    nome VARCHAR(100) NOT NULL,
    categoria VARCHAR(45) NOT NULL,
    registromaritimo VARCHAR(50) NOT NULL UNIQUE,
    disponibilidade BOOLEAN NOT NULL,
    cpf_cnpj VARCHAR(11) NOT NULL UNIQUE,
    datanascimento DATE NOT NULL,
    genero VARCHAR(20) NOT NULL,
    telefone VARCHAR(15) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE,
    fk_id_usuario UUID,
    CONSTRAINT fk_usuario FOREIGN KEY (fk_id_usuario) REFERENCES Usuario(id_usuario) ON DELETE CASCADE
);
CREATE TABLE Embarcacao (
    id_embarcacao UUID PRIMARY KEY, 
    nome VARCHAR(255) NOT NULL,
    anofabricacao INT NOT NULL,
    fabricante VARCHAR(255) NOT NULL, 
    preco FLOAT NOT NULL, 
    potencia INT NOT NULL, 
    tamanho FLOAT, 
    capacidade INT NOT NULL, 
    categoria VARCHAR(255) NOT NULL, 
    regras VARCHAR(400),
    descricao VARCHAR(400), 
    enderecoembarque VARCHAR(255) NOT NULL, 
    disponibilidade BOOLEAN NOT NULL, 
    pet BOOLEAN, 
    quantidadebanheiro INT NOT NULL, 
    quantidadecabines INT NOT NULL, 
    inscricao_IMO VARCHAR(255) NOT NULL, 
    bandeira VARCHAR(255) NOT NULL,
    fk_id_usuario UUID,
    fk_id_endereco UUID, 
    CONSTRAINT fk_usuario FOREIGN KEY (fk_id_usuario) REFERENCES Usuario(id_usuario) ON DELETE CASCADE
    CONSTRAINT fk_endereco FOREIGN KEY (fk_id_endereco) REFERENCES Endereco(id_endereco) ON DELETE SET NULL
);

CREATE TABLE Pagamento (
    id_pagamento UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    banco VARCHAR(50),
    numeroCartao VARCHAR(50),
    metodoPagamento VARCHAR(50),
    valor DECIMAL,
    dataPagamento DATE
);

-- Create the Agendamento table
CREATE TABLE Agendamento (
    id_agendamento UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    dataInicio DATE,
    status VARCHAR(50),
    dataFinal DATE,
    fk_id_usuario UUID REFERENCES Usuario(id_usuario) ON DELETE CASCADE,
    fk_id_marinheiro UUID REFERENCES Marinheiro(id_marinheiro),
	fk_id_embarcacao UUID REFERENCES Embarcacao(id_embarcacao) ON DELETE RESTRICT

	
);

-- Create the Avaliacao table
CREATE TABLE Avaliacao (
    id_avaliacao SERIAL PRIMARY KEY,
    comentario VARCHAR(255),
    notaMarinheiro INT,
    notaEmbarcacao INT,
    notaAgendamento INT,
    fk_id_usuario UUID REFERENCES Usuario(id_usuario) ON DELETE CASCADE,
    fk_id_agendamento UUID REFERENCES Agendamento(id_agendamento),
    fk_id_marinheiro UUID REFERENCES Marinheiro(id_marinheiro),
	fk_id_embarcacao UUID REFERENCES Embarcacao(id_embarcacao) ON DELETE RESTRICT
);

-- Create the Documentos table
CREATE TABLE Documentos (
    id_documento UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    status VARCHAR(50),
    formato VARCHAR(50),
    fk_id_usuario UUID REFERENCES Usuario(id_usuario) ON DELETE CASCADE,
    documento BYTEA,
    nome VARCHAR(50)
);

-- Create the usuario_pagamento table
CREATE TABLE usuario_pagamento (
    id_usuario UUID REFERENCES Usuario(id_usuario) ON DELETE RESTRICT,
    id_pagamento UUID REFERENCES Pagamento(id_pagamento) ON DELETE SET NULL,
    PRIMARY KEY (id_usuario, id_pagamento)
);


-- Create the ContaBanco table
CREATE TABLE ContaBanco (
    id_conta SERIAL PRIMARY KEY,
    banco VARCHAR(50) NOT NULL,
    numeroConta VARCHAR(50) NOT NULL,
    agencia VARCHAR(20) NOT NULL,
    fk_id_usuario UUID REFERENCES Usuario(id_usuario) ON DELETE CASCADE
);


CREATE TABLE AprovacaoDocumento (
    id_aprovacao UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    fk_id_documento UUID REFERENCES Documentos(id_documento) ON DELETE CASCADE,
    status_aprovacao VARCHAR(50) CHECK (status_aprovacao IN ('Pendente', 'Aprovado', 'Rejeitado')),
    data_aprovacao DATE,
    observacoes VARCHAR(50),
    fk_id_usuario UUID REFERENCES Usuario(id_usuario) ON DELETE CASCADE
);

CREATE TABLE ImagemEmbarcacao (
    id_imagem SERIAL PRIMARY KEY,
    nome VARCHAR(255),
    imagem BYTEA NOT NULL,
    fk_id_embarcacao UUID REFERENCES Embarcacao(id_embarcacao) ON DELETE CASCADE,
    formato VARCHAR(50)
);